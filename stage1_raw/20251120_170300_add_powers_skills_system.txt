### TAGS
#database-migration
#alembic
#sqlalchemy
#powers-system
#skills-system
#json-storage

### TYPE
database-migration

### SUMMARY
Adds a powers and skills system to a game/database by creating a `powers` table and JSON fields for abilities/skills in `cards`.

### DETAILS
This migration script implements a **powers and skills** system using SQLAlchemy and Alembic. It creates a dedicated `powers` table to store ability metadata (e.g., name, type, level) linked via foreign keys to `worlds` and `users`. The `cards` table is extended with JSON fields (`powers` and `skills`) to store dynamic, nested data for each card instance. The `metadata` field in the `powers` table allows flexible JSON storage for custom attributes.

### KEY_FUNCTIONS
- **`upgrade()`**: Executes Alembicâ€™s upgrade logic to:
  - Create the `powers` table with fields for ability attributes.
  - Add `powers` and `skills` JSON columns to the `cards` table.
- **`downgrade()`**: Reverts changes by:
  - Dropping the `powers` table.
  - Removing the `powers` and `skills` JSON columns from `cards`.

### DEPENDENCIES
`alembic`, `sqlalchemy`, `sqlalchemy.dialects.postgresql` (for `JSONB` support).

### USAGE
1. Run via Alembic command (`alembic upgrade head`) to apply changes.
2. Use the `powers` table to manage abilities (e.g., `INSERT INTO powers (...) VALUES (...)`).
3. Store abilities/skills in `cards` via JSON (e.g., `{"powers": [...], "skills": [...]}`).

### RELATED
[[`20251120_170100`]], [[`cards` table schema]], [[`users`/`worlds` tables]]

### CALLOUTS
>[!INFO]- JSONB Limitation
> JSONB fields (`powers`/`skills`) in `cards` are stored as arrays. For nested structures, flatten or use stringified JSON (e.g., `{"powers": "[...]"}`). Avoid circular references.
>[!WARNING]- Foreign Key Constraints
> Ensure `world_id`/`user_id` exist in `worlds`/`users` tables before running `upgrade()`. Otherwise, `ForeignKeyConstraint` violations will occur.